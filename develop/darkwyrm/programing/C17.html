

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>第十七课 &mdash; Haiku 中文文档</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Haiku 中文文档" href="../../../index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../../index.html" class="icon icon-home"> Haiku Chinese Documents
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../关于Haiku.html">关于 Haiku</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../关于Haiku.html#id1">Haiku 好处在哪儿？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../关于Haiku.html#id2">为何选择 Haiku ？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../关于Haiku.html#id3">谁支持着 Haiku ？</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../开发.html">开发</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../开发.html#id2">用户指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../开发.html#id3">开发文档</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../开发入门.html">开发入门</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id2">手册相关</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id3">入门任务</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id4">当您找到任务</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id5">编写代码准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#git">获取 GIT 提交权限</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id6">深入阅读</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku编程学习.html">Haiku编程学习</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程学习.html#id1">简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程学习.html#id2">目录</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程学习.html#id3">参考资料和工具</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku编程教程.html">Haiku 编程详解</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程教程.html#id1">前言</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程教程.html#id2">内容概览</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku指南.html">Haiku 指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#guides-haiku"><code class="docutils literal"><span class="pre">/guides/构建Haiku</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id1"><code class="docutils literal"><span class="pre">/guides/安装Haiku</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id2"><code class="docutils literal"><span class="pre">/guides/启动Haiku</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#guides"><code class="docutils literal"><span class="pre">/guides/日常任务</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id3"><code class="docutils literal"><span class="pre">/guides/虚拟化</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id4">其他指南</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku源码规范.html">Haiku 编码规范</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id2">规范概况</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id3">缩进和空格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id4">杂项</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id5">标识符</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id6">变量声明</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#haiku-api">使用 Haiku 内置的 API，类型等</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id7">注释</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id8">许可和版权</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id9">无用代码和调试代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id10">其他的要求</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id11">风格检查工具</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../开发常见问题（FAQ）.html">开发常见问题（FAQ）</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id1">我是一个程序员，希望可以帮忙，那么从何开始呢？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id4">是否有简单的引导任务？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id6">是否有特定的编程风格？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id7">如何创建和提交补丁？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#trac">为什么无法在 Trac 中创建任务单？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id8">使用哪些开发工具？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id9">是否有开发者邮件列表？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#irc">是否有 IRC 聊天室？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id10">我尝试进行测试，但是 Haiku 编译失败。接下来该如何操作？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id11">我想把一些东西集成到官方源之中，可以集成那些组件？该使用何种协议呢？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#beos-haiku">我希望可以把我的 BeOS 程序/驱动移植到 Haiku，该如何进行？</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Haiku图标指南.html">Haiku 图标指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id1">透视效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id2">光源效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id3">渐变效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id4">色彩效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id5">阴影效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id6">轮廓线</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id7">高亮效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id8">使用覆盖</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id9">细节</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id10">中立图标</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../开发.html#id4">在线资源</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../开发.html#id7">开发工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../开发.html#id8">其他系统交叉编译</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../文档.html">文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../文档.html#id2">用户文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../文档.html#id3">开发者文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../文档.html#id4">早期文档</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../文档.html#bebook-be">BeBook 和 Be 信札</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../文档.html#id5">其他</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Haiku Chinese Documents</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
    <li>第十七课</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="id1">
<h1><a class="toc-backref" href="#id6">第十七课</a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="contents topic" id="id2">
<p class="topic-title first">内容</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id6">第十七课</a><ul>
<li><a class="reference internal" href="#haiku" id="id7">Haiku 控件方式</a></li>
<li><a class="reference internal" href="#colorwell" id="id8">我们的新控件：ColorWell</a><ul>
<li><a class="reference internal" href="#colorwell1-h" id="id9">ColorWell1.h</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3" id="id10">编写ColorWell代码</a><ul>
<li><a class="reference internal" href="#colorwell1-cpp" id="id11">ColorWell1.cpp</a></li>
<li><a class="reference internal" href="#app-h" id="id12">App.h</a></li>
<li><a class="reference internal" href="#app-cpp" id="id13">App.cpp</a></li>
<li><a class="reference internal" href="#mainwindow-h" id="id14">MainWindow.h</a></li>
<li><a class="reference internal" href="#mainwindow-cpp" id="id15">MainWindow.cpp</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4" id="id16">最后思考</a></li>
<li><a class="reference internal" href="#id5" id="id17">深入了解</a></li>
</ul>
</li>
</ul>
</div>
<p>界面套件（Interface Kit）全部用于创建和使用图形界面中的控件。在一些早期的课程中，我们接触到了套件中存在的一些控件，但是为了充分理解和使用它们，我们需要创建自定义的控件。为此，我们需要了解界面套件的不同部分，以便更有效地加以利用。</p>
<div class="section" id="haiku">
<h2><a class="toc-backref" href="#id7">Haiku 控件方式</a><a class="headerlink" href="#haiku" title="永久链接至标题">¶</a></h2>
<p>如果您从事编程已经有了一段时间，您可能知道了一些好的代码设计模式。如果还没有，您可以从 Haiku 的 API 中获得此道。Be Inc. 的开发人员非常谨慎的设计了一套 API 并且使之非常易于使用。其中也使用了一些范式，在一些特定的场合可以加以巧妙的使用。</p>
<p>在界面套件中控件设计的一项内容就是使用轻量级对象来构建列表。BListView 和BOutlineListView 类就是最好的证明。它们都可能会包含很多项目，因此每一个都必须占据尽可能小的空间。BStringItem 对象，根据自己的列表进行相应的绘制，而不是每个对象单独的作为BView对象进行。它们只关心很少的数据，比如 BStringItem 的例子。</p>
<p>洁面套件中常用到的另一个规则是尽可能使用已经存在的类实现您的控件。例如，BTextControl 只是 BTextView 单行显示的一个特殊情况。通过在您的控件中使用标准的控件而不是重新进行实现，您可以保持界面对用户的一致性。</p>
<p>与您的控件进行交互的 API 应该遵循界面套件的其他类中所用的惯例。提供事件的钩子函数。如果您的控件具有一个值和一个标签，最好使其作为 BControl 的子类。需要注意的是，并不是界面套件中的所有控件都需要这样，如 BListView。如果您不适用 BControl 子类，混合使用 BInvoker 类则可以很容易的修改消息目标对象，并且可以为控件的消息处理提供相似的接口。将数据返回函数编写为 const 函数，这样可以显示的告诉编译器它们不改变对象的状态。最后，除非套件中不存在可用于并且适合于当前任务的控件时，不要添加新控件。通常可以将一个或多个控件组合来完成需要添加专门控件来完成的任务。Work smarter, not harder。</p>
</div>
<div class="section" id="colorwell">
<h2><a class="toc-backref" href="#id8">我们的新控件：ColorWell</a><a class="headerlink" href="#colorwell" title="永久链接至标题">¶</a></h2>
<p>Haiku  API 所缺少的控件类型是颜色显示控件。除了图像和文本，Haiku 也允许将颜色拖拽至其他位置。我们将创建一个色彩，用于保存和显示颜色值，并且支持拖拽颜色至其他位置，并且接受拖拽的颜色。需要注意的是，我们并不会创建一个颜色拾取工具来修改颜色，这个任务可以由 BColorControl 类来完成。</p>
<p>对于控件，我们还需要将一些内容牢记于心。首先，颜色可以由32位整型或者 rgb_color 对象来表示，因此我们需要同时支持这两种方式的颜色赋值和返回。其次，我们需要同时提供圆形和矩形两种样式，以满足程序中可能出现的需要。第三，我们需要能够禁用该控件，因此我们需要为控件设计一种禁用状态下的外观，并且要能够很容易分辨。</p>
<p>下面是我们的头文件：</p>
<div class="section" id="colorwell1-h">
<h3><a class="toc-backref" href="#id9">ColorWell1.h</a><a class="headerlink" href="#colorwell1-h" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#ifndef COLOR_WELL_H</span>
<span class="cp">#define COLOR_WELL_H</span>

<span class="cp">#include &lt;Control.h&gt;</span>

<span class="k">enum</span>
<span class="p">{</span>
        <span class="n">COLORWELL_SQUARE_WELL</span><span class="p">,</span>
        <span class="n">COLORWELL_ROUND_WELL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">ColorWell</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BControl</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>                         <span class="n">ColorWell</span><span class="p">(</span><span class="n">BRect</span> <span class="n">frame</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">BMessage</span><span class="o">*</span> <span class="n">msg</span><span class="p">,</span>
        <span class="n">int32</span> <span class="n">resize</span> <span class="o">=</span> <span class="n">B_FOLLOW_LEFT</span> <span class="o">|</span>
        <span class="n">B_FOLLOW_TOP</span><span class="p">,</span>
        <span class="n">int32</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">B_WILL_DRAW</span><span class="p">,</span>
        <span class="n">int32</span> <span class="n">style</span> <span class="o">=</span> <span class="n">COLORWELL_SQUARE_WELL</span><span class="p">);</span>
        <span class="o">~</span><span class="n">ColorWell</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">void</span>            <span class="nf">SetValue</span><span class="p">(</span><span class="n">int32</span> <span class="n">value</span><span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">void</span>            <span class="nf">SetValue</span><span class="p">(</span><span class="k">const</span> <span class="n">rgb_color</span> <span class="o">&amp;</span><span class="n">color</span><span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">void</span>            <span class="nf">SetValue</span><span class="p">(</span><span class="k">const</span> <span class="n">uint8</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span>
        <span class="k">const</span> <span class="n">uint8</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
        <span class="n">rgb_color</span>               <span class="n">ValueAsColor</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
        <span class="k">virtual</span>                 <span class="nf">SetStyle</span><span class="p">(</span><span class="k">const</span> <span class="n">int32</span> <span class="o">&amp;</span><span class="n">style</span><span class="p">);</span>
        <span class="n">int32</span>           <span class="n">Style</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
        <span class="k">virtual</span> <span class="kt">void</span>            <span class="nf">Draw</span><span class="p">(</span><span class="n">BRect</span> <span class="n">update</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
        <span class="kt">void</span>                    <span class="n">DrawBound</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
        <span class="kt">void</span>                    <span class="nf">DrawSquare</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
        <span class="n">rgb_color</span>       <span class="n">fDisabledColor</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">;</span>
        <span class="n">int32</span>           <span class="n">fStyle</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif</span>
</pre></div>
</div>
<p>看了上面的类，思考一下该如何实现这些方法。</p>
<p>在我们进行编写代码之前，我们来快速了解一下 BView 如何来进行绘制。BView 对自己的绘制需要经过四个步骤：无效激活，绘制，子视图绘制，深层子视图绘制。无效激活是指 BView 告诉 app_server 其区域中的某块需要重绘。无效区域可能由多种情况产生，如窗口隐藏了其部分内容，现在它不希望继续隐藏，或者内部的值发生变化，BView 需要更新期标签。之后，BView 将会开始进行自我重绘，这由 Draw() 钩子函数处理。在视图进行自我绘制时，其需要确保其子视图按需要进行重绘。当然也可以在其所有的子 BView 完成更新之后，再进行 BView 绘制。而这类绘制通过 DrawAfterChildren() 钩子函数来完成。尽管该函数并不常用。</p>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id10">编写ColorWell代码</a><a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<div class="section" id="colorwell1-cpp">
<h3><a class="toc-backref" href="#id11">ColorWell1.cpp</a><a class="headerlink" href="#colorwell1-cpp" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &quot;ColorWell1.h&quot;</span>

<span class="n">ColorWell</span><span class="o">::</span><span class="n">ColorWell</span><span class="p">(</span><span class="n">BRect</span> <span class="n">frame</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="n">BMessage</span><span class="o">*</span> <span class="n">message</span><span class="p">,</span>
        <span class="n">int32</span> <span class="n">resize</span><span class="p">,</span> <span class="n">int32</span> <span class="n">flags</span><span class="p">,</span> <span class="n">int32</span> <span class="n">style</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">BControl</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">resize</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">SetViewColor</span><span class="p">(</span><span class="n">ui_color</span><span class="p">(</span><span class="n">B_PANEL_BACKGROUND_COLOR</span><span class="p">));</span>
        <span class="n">SetLowColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

        <span class="n">fColor</span><span class="p">.</span><span class="n">red</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">green</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">blue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>

        <span class="n">fDisabledColor</span><span class="p">.</span><span class="n">red</span> <span class="o">=</span> <span class="mi">190</span><span class="p">;</span>
        <span class="n">fDisabledColor</span><span class="p">.</span><span class="n">green</span> <span class="o">=</span> <span class="mi">190</span><span class="p">;</span>
        <span class="n">fDisabledColor</span><span class="p">.</span><span class="n">blue</span> <span class="o">=</span> <span class="mi">190</span><span class="p">;</span>
        <span class="n">fDisabledColor</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ColorWell</span><span class="o">::~</span><span class="n">ColorWell</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">SetValue</span><span class="p">(</span><span class="n">int32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">//通过整型来进行颜色赋值看起来可能有点奇怪，但是它是</span>
        <span class="c1">// BControl驱动的控件所期望的，因此我们需要尽可能的支持。</span>
        <span class="n">BControl</span><span class="o">::</span><span class="n">SetValue</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

        <span class="c1">// int32 可用于传递颜色，因为它包含了4个8位的整型。将它</span>
        <span class="c1">// 们转换为RGB格式需要一些移位操作。</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">red</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xFF000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x00FF0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">blue</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x0000FF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>

        <span class="n">SetHighColor</span><span class="p">(</span><span class="n">fColor</span><span class="p">);</span>
        <span class="n">Draw</span><span class="p">(</span><span class="n">Bounds</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">SetValue</span><span class="p">(</span><span class="k">const</span> <span class="n">rgb_color</span> <span class="o">&amp;</span><span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">fColor</span> <span class="o">=</span> <span class="n">col</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
        <span class="c1">// 因为BControl::Value()需要返回恰当的值而忽略值的赋值形式，</span>
        <span class="c1">// 所以需要调用该方法的BControl版本。</span>
        <span class="n">BControl</span><span class="o">::</span><span class="n">SetValue</span><span class="p">((</span><span class="n">fColor</span><span class="p">.</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">fColor</span><span class="p">.</span><span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span>
        <span class="p">(</span><span class="n">fColor</span><span class="p">.</span><span class="n">blue</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">255</span><span class="p">);</span>
        <span class="n">SetHighColor</span><span class="p">(</span><span class="n">col</span><span class="p">);</span>
        <span class="n">Draw</span><span class="p">(</span><span class="n">Bounds</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">SetValue</span><span class="p">(</span><span class="k">const</span> <span class="n">uint8</span><span class="o">&amp;</span> <span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span><span class="o">&amp;</span> <span class="n">g</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">red</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">green</span> <span class="o">=</span> <span class="n">g</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">blue</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">fColor</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>

        <span class="n">BControl</span><span class="o">::</span><span class="n">SetValue</span><span class="p">((</span><span class="n">fColor</span><span class="p">.</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">fColor</span><span class="p">.</span><span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span>
        <span class="p">(</span><span class="n">fColor</span><span class="p">.</span><span class="n">blue</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">fColor</span><span class="p">.</span><span class="n">alpha</span><span class="p">);</span>
        <span class="n">SetHighColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="n">Draw</span><span class="p">(</span><span class="n">Bounds</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">SetStyle</span><span class="p">(</span><span class="k">const</span> <span class="n">int32</span><span class="o">&amp;</span> <span class="n">style</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">style</span> <span class="o">!=</span> <span class="n">fStyle</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="n">fStyle</span> <span class="o">=</span> <span class="n">style</span><span class="p">;</span>
        <span class="n">Invalidate</span><span class="p">();</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="n">int32</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">Style</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="n">fStyle</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">Draw</span><span class="p">(</span><span class="n">BRect</span> <span class="n">update</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fStyle</span> <span class="o">==</span> <span class="n">COLORWELL_SQUARE_WELL</span><span class="p">)</span>
        <span class="n">DrawSquare</span><span class="p">();</span>
        <span class="k">else</span>
        <span class="nf">DrawRound</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">rgb_color</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">ValueAsColor</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="n">fColor</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">DrawRound</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">// 真正的控件需要更多的工作以便让它更为美观，</span>
        <span class="c1">// 但是在这里我们只需要一个简单的黑色边框即可。</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsEnabled</span><span class="p">())</span>
        <span class="n">SetHighColor</span><span class="p">(</span><span class="n">fColor</span><span class="p">);</span>
        <span class="k">else</span>
        <span class="nf">SetHighColor</span><span class="p">(</span><span class="n">fDisabledColor</span><span class="p">);</span>

        <span class="n">FillEllipse</span><span class="p">(</span><span class="n">Bounds</span><span class="p">());</span>

        <span class="n">SetHighColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">StrokeEllipse</span><span class="p">(</span><span class="n">Bounds</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">ColorWell</span><span class="o">::</span><span class="n">DrawSquare</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">// ColorWell的矩形版本并不会比圆形复杂</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsEnabled</span><span class="p">())</span>
        <span class="n">SetHighColor</span><span class="p">(</span><span class="n">fColor</span><span class="p">);</span>
        <span class="k">else</span>
        <span class="nf">SetHighColor</span><span class="p">(</span><span class="n">fDisableColor</span><span class="p">);</span>

        <span class="n">FillRect</span><span class="p">(</span><span class="n">Bounds</span><span class="p">());</span>
        <span class="p">;</span>
        <span class="n">SetHighColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">StrokeRect</span><span class="p">(</span><span class="n">Bounds</span><span class="p">());</span>

<span class="p">}</span>
</pre></div>
</div>
<p>上述这些方法都不需要太多的思考。这并不奇怪。Haiku 提供的用于创建控件的框架已经提供了足够的特性，它们足以完成很多重要的任务，并且不会很复杂。现在我们完成项目剩余的工作，使用必要的 GUI 测试我们的新控件。</p>
</div>
<div class="section" id="app-h">
<h3><a class="toc-backref" href="#id12">App.h</a><a class="headerlink" href="#app-h" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#ifndef APP_H</span>
<span class="cp">#define APP_H</span>

<span class="cp">#include &lt;Application.h&gt;</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BApplication</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
        <span class="n">App</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="section" id="app-cpp">
<h3><a class="toc-backref" href="#id13">App.cpp</a><a class="headerlink" href="#app-cpp" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &quot;App.h&quot;</span>
<span class="cp">#include &quot;MainWindow.h&quot;</span>
<span class="n">App</span><span class="o">::</span><span class="n">App</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="o">:</span>       <span class="n">BApplication</span><span class="p">(</span><span class="s">&quot;application/x-vnd.jy-ColorWellDemol&quot;</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">MainWindow</span> <span class="o">*</span><span class="n">mainwin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MainWindow</span><span class="p">();</span>
        <span class="n">Mainwin</span><span class="o">-&gt;</span><span class="n">Show</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">App</span> <span class="o">*</span><span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">App</span><span class="p">();</span>
        <span class="n">App</span><span class="o">-&gt;</span><span class="n">Run</span><span class="p">();</span>
        <span class="k">delete</span> <span class="n">app</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="mainwindow-h">
<h3><a class="toc-backref" href="#id14">MainWindow.h</a><a class="headerlink" href="#mainwindow-h" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#ifndef MAINWINDOW_H</span>
<span class="cp">#define MAINWINDOW_H</span>

<span class="cp">#include &lt;Window.h&gt;</span>
<span class="cp">#include &lt;MenuBar.h&gt;</span>

<span class="k">class</span> <span class="nc">ColorWell</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MainWindow</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BWindow</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
        <span class="n">MainWindow</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
        <span class="kt">void</span>            <span class="nf">MessageReceived</span><span class="p">(</span><span class="n">BMessage</span><span class="o">*</span> <span class="n">msg</span><span class="p">);</span>
        <span class="kt">bool</span>                    <span class="nf">QuitRequested</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
        <span class="n">BMenuBar</span><span class="o">*</span>       <span class="n">fMenuBar</span><span class="p">;</span>
        <span class="n">ColorWell</span><span class="o">*</span>      <span class="n">fColorWell</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="section" id="mainwindow-cpp">
<h3><a class="toc-backref" href="#id15">MainWindow.cpp</a><a class="headerlink" href="#mainwindow-cpp" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre>#include &quot;MainWindow.h&quot;

#include &lt;Application.h&gt;
#include &lt;Menu.h&gt;
#include &lt;MenuItem.h&gt;
#include &lt;View.h&gt;
#include &quot;ColorWell1.h&quot;

enum
{
        M_SET_COLOR = &#39;stcl&#39;,
        M_COLOR_UPDATED = &#39;mcup&#39;,
        M_SET_SHAPE_CIRCLE = &#39;sscr&#39;,
        M_SET_SHAPE_SQUARE = &#39;sssq&#39;
};

MainWindow::MainWindow(void)
        :       BWindow(BRect(100,100,500,400), &quot;ColorWell Demo&quot;,
        B_TITLED_WINDOW, B_ASYNCHRONOUS_CONTROLS)
{
        BRect r(Bounds());
        R.bottom = 20;
        fMenuBar = new BMenuBar(r, &quot;menubar&quot;);
        AddChild(fMenuBar);

        // 创建一个背景视图以使窗口看起来正常些。如果您在
        // BWindow中有一组控件，最好创建一个背景视图。
        r = Bounds();
        r.top = 20;
        BView* background = new BView(r, &quot;background&quot;, B_FOLLOW_ALL,
        B_WILL_DRAW);

        // SetViewColor() 设置视图的背景颜色。ui_color() 是一个全局的
        // C++ 函数，用以返回给定系统颜色常量的rgb_color值。
        // B_PANEL_BACKGROUND_COLOR 恰好是BView默认的背景
        // 颜色，默认情况下其值为 (216,216,216)。
        background-&gt;SetViewColor(ui_color(B_PANEL_BACKGROUND_COLOR));
        AddChild(background);

        // 创建我们的color well 控件。它比实际需要时用到的要大，
        // 但是对于演示来说，还过得去。
        fColorWell = new ColorWell(BRect(15,15,165,165), &quot;color well&quot;,
        new BMessage(M_COLOR_UPDATED));

        // 注意，我们在这里调用了背景视图的AddChild方法。如果
        // 两个具有相同父控件的视图彼此重叠，根据 Be Book，其结果
        // 将是不可预期的。但是，在多数情况下，可能会出现绘制错误，
        // 较晚添加的视图将无法获得鼠标焦点。
        background-&gt;AddChild(fColorWell);

        BMenu* menu = new BMenu(&quot;Color&quot;);
        fMenuBar-&gt;AddItem(menu);

        // BMessage可以附带数据。这样，它们就是非常方便的数据容器。
        // 下面我们将为每个彩色菜单条目的消息附带一个颜色。
        // 尽管这不是附加颜色的标准方法，但是在本实例中，它已经足以
        // 胜任了。
        BMessage* msg = new BMessage(M_SET_COLOR);
        msg-&gt;AddInt8(&quot;red&quot;, 160);
        msg-&gt;AddInt8(&quot;green&quot;, 0);
        msg-&gt;AddInt8(&quot;blue&quot;, 0);
        menu-&gt;AddItem(new BMenuItem(&quot;Red&quot;, msg, &#39;R&#39;, B_COMMAND_KEY));

        msg = new BMessage(M_SET_COLOR);
        msg-&gt;AddInt8(&quot;red&quot;, 0);
        msg-&gt;AddInt8(&quot;green&quot;,160);
        msg-&gt;AddInt8(&quot;blue&quot;, 0);
        menu-&gt;AddItem(new BMenuItem(&quot;Green&quot;, msg, &#39;G&#39;, B_COMMAND_KEY));
        msg = new BMessage(M_SET_COLOR);
        msg-&gt;AddInt8(&quot;red&quot;, 0);
        msg-&gt;AddInt8(&quot;green&quot;,0);
        msg-&gt;AddInt8(&quot;blue&quot;, 160);
        menu-&gt;AddItem(new BMenuItem(&quot;Blue&quot;, msg, &#39;B&#39;, B_COMMAND_KEY));

        menu = new BMenu(&quot;Shape&quot;);
        fMenuBar-&gt;AddItem(menu);

        menu-&gt;AddItem(new BMenuItem(&quot;Square&quot;,
        new BMessage(M_SET_SHAPE_SQUARE), &#39;S&#39;, B_COMMAND_KEY));
        menu-&gt;AddItem(new BMenuItem(&quot;Circle&quot;,
        new BMessage(M_SET_SHAPE_CIRCLE), &#39;C&#39;, B_COMMAND_KEY));
}

void
MainWindow::MessageReceived(BMessage* msg)
{
        switch (msg-&gt;what)
        {
        case M_SET_COLOR:
        {
        // 获取保存的颜色值，并将其放入ColorWell。
        int8 red, green, blue;
        msg-&gt;FindInt8(&quot;red&quot;, &amp;red);
        msg-&gt;FindInt8(&quot;green&quot;, &amp;green);
        msg-&gt;FindInt8(&quot;blue&quot;, &amp;blue);

        fColorWell-&gt;SetValue(red, green, blue);
        break;
        }
        case M_SET_SHAPE_CIRCLE:
        {
        fColorWell-&gt;SetStyle(COLORWELL_ROUND_WELL);
        break;
        }
        case M_SET_SHAPE_SQUARE:
        {
        fColorWell-&gt;SetStyle(COLORWELL_SQUARE_WELL);
        break;
        }
        default:
        {
        BWindow::MessageReceived(msg);
        break;
        }

        }
}

bool
MainWindow::QuitRequested(void)
{
        be_app-&gt;PostMessage(B_QUIT_REQUESTED);
        return true;
}
</pre></div>
</div>
<p>在完成这些代码之后，构建你的程序，然后您就可以看到一个运行的演示程序，它将会显示一个彩色的样例，并且可以根据我们的需要修改相应的颜色。当然它只能够显示当前的颜色。目前它已经非常接近 BColorControl，因为您可以编辑颜色，并且可以将其显示。还不错。</p>
<img alt="../../../_images/lesson17_1_2.gif" src="../../../_images/lesson17_1_2.gif" />
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id16">最后思考</a><a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>现在我们已经有了一个基本的控件。如果这是为了实现一个大型的项目，那么这个快捷而糟糕的类确实可以胜任，我们这样设计就已经足够了，但是如果目标是实现一个成熟全面的 Haiku 控件类，还需要进行更多的工作。但是通常您并不需要实现所有不同的需要放置到我们的 ColorWell 类中的组件，但是对这些特性使用的了解，可以让您的视野更加的开阔。</p>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id17">深入了解</a><a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>这不仅仅是一个练习。它也是您的代码，因此尝试思考一下您可以在其他项目中如何使用该控件，或者您希望为其添加一些其他方便有益的特性。</p>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; 版权所有 2015, Haiku Chinese Group.
      最后更新于 Aug 18, 2016.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>