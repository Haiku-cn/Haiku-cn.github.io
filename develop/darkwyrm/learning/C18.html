

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>第十八课 &mdash; Haiku 中文文档</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Haiku 中文文档" href="../../../index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../../index.html" class="icon icon-home"> Haiku Chinese Documents
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../关于Haiku.html">关于 Haiku</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../关于Haiku.html#id1">Haiku 好处在哪儿？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../关于Haiku.html#id2">为何选择 Haiku ？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../关于Haiku.html#id3">谁支持着 Haiku ？</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../开发.html">开发</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../开发.html#id2">用户指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../开发.html#id3">开发文档</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../开发入门.html">开发入门</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id2">手册相关</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id3">入门任务</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id4">当您找到任务</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id5">编写代码准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#git">获取 GIT 提交权限</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发入门.html#id7">深入阅读</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku编程学习.html">Haiku编程学习</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程学习.html#id1">简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程学习.html#id2">目录</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程学习.html#id3">参考资料和工具</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku编程教程.html">Haiku 编程详解</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程教程.html#id1">前言</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku编程教程.html#id2">内容概览</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku指南.html">Haiku 指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#guides-haiku"><code class="docutils literal"><span class="pre">/guides/构建Haiku</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id1"><code class="docutils literal"><span class="pre">/guides/安装Haiku</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id2"><code class="docutils literal"><span class="pre">/guides/启动Haiku</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#guides"><code class="docutils literal"><span class="pre">/guides/日常任务</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id3"><code class="docutils literal"><span class="pre">/guides/虚拟化</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku指南.html#id4">其他指南</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Haiku源码规范.html">Haiku 编码规范</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id2">规范概况</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id3">缩进和空格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id4">杂项</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id5">标识符</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id6">变量声明</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#haiku-api">使用 Haiku 内置的 API，类型等</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id7">注释</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id8">许可和版权</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id9">无用代码和调试代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id10">其他的要求</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Haiku源码规范.html#id11">风格检查工具</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../开发常见问题（FAQ）.html">开发常见问题（FAQ）</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id1">我是一个程序员，希望可以帮忙，那么从何开始呢？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id4">是否有简单的引导任务？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id6">是否有特定的编程风格？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id7">如何创建和提交补丁？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#trac">为什么无法在 Trac 中创建任务单？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id8">使用哪些开发工具？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id9">是否有开发者邮件列表？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#irc">是否有 IRC 聊天室？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id10">我尝试进行测试，但是 Haiku 编译失败。接下来该如何操作？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#id11">我想把一些东西集成到官方源之中，可以集成那些组件？该使用何种协议呢？</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../开发常见问题（FAQ）.html#beos-haiku">我希望可以把我的 BeOS 程序/驱动移植到 Haiku，该如何进行？</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Haiku图标指南.html">Haiku 图标指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id1">透视效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id2">光源效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id3">渐变效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id4">色彩效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id5">阴影效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id6">轮廓线</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id7">高亮效果</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id8">使用覆盖</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id9">细节</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Haiku图标指南.html#id10">中立图标</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../开发.html#id4">在线资源</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../开发.html#id7">开发工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../开发.html#id8">其他系统交叉编译</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../文档.html">文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../文档.html#id2">用户文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../文档.html#id3">开发者文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../文档.html#id4">早期文档</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../文档.html#bebook-be">BeBook 和 Be 信札</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../文档.html#id5">其他</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Haiku Chinese Documents</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
    <li>第十八课</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="id1">
<h1><a class="toc-backref" href="#id19">第十八课</a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id19">第十八课</a><ul>
<li><a class="reference internal" href="#id2" id="id20">重访类型转换</a></li>
<li><a class="reference internal" href="#id3" id="id21">项目：使用列表控件</a><ul>
<li><a class="reference internal" href="#app-h" id="id22">App.h</a></li>
<li><a class="reference internal" href="#app-cpp" id="id23">App.cpp</a></li>
<li><a class="reference internal" href="#mainwindow-h" id="id24">MainWindow.h</a></li>
<li><a class="reference internal" href="#mainwindow-cpp" id="id25">MainWindow.cpp</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6" id="id26">需要记住的内容</a><ul>
<li><a class="reference internal" href="#bcontrol" id="id27">BControl</a></li>
<li><a class="reference internal" href="#blistview" id="id28">BListView</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>我们已经学了有关菜单和按钮的内容，接下来我们将要开始学习其他可用的窗口控件类型，如下表所示：</p>
<img alt="../../../_images/lesson_18_table.gif" src="../../../_images/lesson_18_table.gif" />
<p>上面给出了很多不同的类！乍看之下，乱花迷眼，但略加提炼，抑或稍加思考，您会发现她们形貌相仿，并非全异。您可能希望将这张表放在手边，以备不时之需。我们并不会对上述每个类都详细阐述，所略过的类都比较简单，非常易于理解。</p>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id20">重访类型转换</a><a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>返回第七节，我们了解了类型转换，例如，将变量中的数据转译为其他不同的类型。在 C 语言中进行转换时存在的问题之一就是安全性 - 无论何时进行转换，它总会成功。如果您选择一个错误的类进行转换，它仍然会成功，这显然会造成无法预期的结果。C++ 提供了不同类型的转换。并且推荐使用 C++ 的转换方式，除非您是在编写 C 代码。如下所示：</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">TypeToCastTo</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">pointerToCast</span><span class="p">);</span>
</pre></div>
</div>
<p>static 转换用于将一种类型转换为其他类型。它依赖于编译期信息，并且通常用于常用的C转换方法的目的 - 修改指针类型和算术转换。仅当 C++ 语言支持的两种类型之间的转换时，它才会成功。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">TypeToCastTo</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">pointerToCast</span><span class="p">);</span>
</pre></div>
</div>
<p>和 static 转换不同，dynamic 转换将会是 Haiku 编程中最常用的转换类型方式。它们用于安全得导航到一个继承体系。如果继承没有将 “from” 和 “to” 类型链接到一起，那么就会返回 NULL。这样，您就仅可以转换为这些您认为可以转换的指针类型。我们将会在这节的项目中用到它们。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">TypeToCastTo</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">pointerToCast</span><span class="p">);</span>
</pre></div>
</div>
<p>const 转换将会添加或者移除指针的可变度。例如，有一些实例中，函数将会接受一个非 const 参数，但不能够对其进行修改。传递一个常量指针给这些函数将会需要进行 const 转换。</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">TypeToCastTo</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">pointerToCast</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>reinterpret_cast 转换很少使用。它将一个指针从一种类型转换为其他类型，而忽略这两者之间的相关性。基本上所有 reinterpret 转换可以完成的任务都可以由 static 转换来完成，并且其他的转换通常都不可移植，因此这种类型的转换仅用于确实需要的地方，例如转换函数指针类型。</p>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id21">项目：使用列表控件</a><a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>本项目，称为 ListTitle，将会使用列表控件，即 BListView 类。在 Haiku API 中发现基于列表的控件使用轻量级的条目。BMenu 和BListView 实际上完成了大部分的工作，而 BMenuItem 和 BListItem 则是非常简单的类。以下面的方式设计类将会节约内存。</p>
<ol class="arabic simple">
<li>在 Paladin 中新建一个项目，但是这次使用 “GUI with Main Window” 模板以节约部分输入 - 这个模板将会为 App 和 MainWindow 类创建基本的代码。</li>
<li>我们的项目和目标命名为 ListTitile。</li>
<li>完成创建后，打开 App.cpp，修改程序的 MIME 标识为 “application/x-vnd.test-ListTitle”，然后关闭。</li>
<li>打开 MainWindow.h，在其顶部添加 ListView.h 头文件。</li>
<li>在 MainWindow 类定义底部添加添加一个 “private:” 访问标号关键字。</li>
<li>在 MainWindow 定义的 private 块中，声明属性 BListView <a href="#id4"><span class="problematic" id="id5">*</span></a>fListView。我们不仅仅在窗口构造函数中使用 fListView，因此使用指针将很有必要。</li>
</ol>
<p>您的 App 类文件和 MainWindow.h 文件应该如下所示：</p>
<div class="section" id="app-h">
<h3><a class="toc-backref" href="#id22">App.h</a><a class="headerlink" href="#app-h" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#ifndef APP_H</span>
<span class="cp">#define APP_H</span>
<span class="cp">#include &lt;Application.h&gt;</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BApplication</span>
<span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
    <span class="n">App</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="section" id="app-cpp">
<h3><a class="toc-backref" href="#id23">App.cpp</a><a class="headerlink" href="#app-cpp" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &quot;App.h&quot;</span>
<span class="cp">#include &quot;MainWindow.h&quot;</span>
<span class="n">App</span><span class="o">::</span><span class="n">App</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="o">:</span> <span class="n">BApplication</span><span class="p">(</span><span class="s">&quot;application/x-vnd.test-ListColors&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">MainWindow</span> <span class="o">*</span><span class="n">mainwin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MainWindow</span><span class="p">();</span>
    <span class="n">mainwin</span><span class="o">-&gt;</span><span class="n">Show</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">App</span> <span class="o">*</span><span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">App</span><span class="p">();</span>
    <span class="n">app</span><span class="o">-&gt;</span><span class="n">Run</span><span class="p">();</span>
    <span class="k">delete</span> <span class="n">app</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="mainwindow-h">
<h3><a class="toc-backref" href="#id24">MainWindow.h</a><a class="headerlink" href="#mainwindow-h" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#ifndef MAINWINDOW_H</span>
<span class="cp">#define MAINWINDOW_H</span>
<span class="cp">#include &lt;Window.h&gt;</span>
<span class="cp">#include &lt;ListView.h&gt;</span>
<span class="k">class</span> <span class="nc">MainWindow</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BWindow</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">MainWindow</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">MessageReceived</span><span class="p">(</span><span class="n">BMessage</span> <span class="o">*</span><span class="n">msg</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">BListView</span> <span class="o">*</span><span class="n">fListView</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>现在进入正题：设置 MainWindow 的控件并且让它们有所动作。
打开 MainWindow.cpp，然后做如下修改：</p>
</div>
<div class="section" id="mainwindow-cpp">
<h3><a class="toc-backref" href="#id25">MainWindow.cpp</a><a class="headerlink" href="#mainwindow-cpp" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre>#include &quot;MainWindow.h&quot;
#include &lt;Button.h&gt;
#include &lt;ListItem.h&gt;
#include &lt;ScrollView.h&gt;

enum
{
    M_RESET_WINDOW = &#39;rswn&#39;,
    M_SET_TITLE = &#39;sttl&#39;
};

MainWindow::MainWindow(void)
    :       BWindow(BRect(100,100,500,400),&quot;The Weird World of Sports&quot;,
                    B_TITLED_WINDOW, B_ASYNCHRONOUS_CONTROLS | B_QUIT_ON_WINDOW_CLOSE)
{
    // 下面我们将创建一个BView，它将覆盖窗口内部所有白色区域，这样
    // 我们就可以选择一个背景颜色。您将会希望在你的项目的窗口中这样
    // 做 -- 您的项目看起来将会很专业。
    BRect r(Bounds());
    BView *top = new BView(r,&quot;topview&quot;,B_FOLLOW_ALL,B_WILL_DRAW);
    AddChild(top);

    // ui_color()返回一个系统颜色，例如窗口标签颜色，菜单文本颜色，
    // 等等。Panel Background颜色用于背景视图，如下所示。
    top-&gt;SetViewColor(ui_color(B_PANEL_BACKGROUND_COLOR));

    // 创建一个按钮，并将其放置在窗口的右下角。
    // 用于BButton图框的BRect是空的，是因为我们将让其重设其尺寸，然
    // 后根据按键的实际大小将其移动到右下角，因此无需指定其尺寸。
    BButton *reset = new BButton(BRect(), &quot;resetbutton&quot;, &quot;Reset&quot;,
                                    new BMessage(M_RESET_WINDOW),
                                    B_FOLLOW_RIGHT | B_FOLLOW_BOTTOM);
    top-&gt;AddChild(reset);
    reset-&gt;ResizeToPreferred();

    // 将按钮放置到窗口右下角，按钮与窗口边界的间隙为10个像素。
    // 10个像素某种程度上说是用于控件填充的事实标准。它已经足以
    // 让控件看起来不拥挤，并且也不占用大量空间。
    reset-&gt;MoveTo(Bounds().right - reset-&gt;Bounds().Width() - 10.0,
    Bounds().bottom - reset-&gt;Bounds().Height() - 10.0);
    r = Bounds();
    r.InsetBy(10.0,10.0);

    // 使用BScrollView，在确定关联到BScrollView的控件尺寸时，您
    // 必须补偿用于滚动栏的宽度/高度。B_V_SCROLL_BAR_WIDTH是用于
    // 水平滚动栏宽度的已定义常量。
    r.right -= B_V_SCROLL_BAR_WIDTH;

    // 图框和Bounds()原理相似，除了它会返回控件在父视图坐标空间内
    // 的尺寸和位置。这会使fListView得底部停靠在控件上方 10 个像素
    // 的地方。
    r.bottom = reset-&gt;Frame().top - 10.0 - B_H_SCROLL_BAR_HEIGHT;

    // 这些参数多数和BView相同，除了我们也可以指定是否用户能够在列
    // 表中选择单个条目或者点击条目时按下键盘上修饰键选择多个项目。
    fListView = new BListView(r, &quot;colorlist&quot;, B_SINGLE_SELECTION_LIST,
                                    B_FOLLOW_ALL);

    // 我们在fListView上并未调用AddChild(),因为BScrollView将会为我们
    // 完成这个操作。创建时，它创建了滚动栏并且把指定的视图作为其执行
    // 滚动时的目标。在BScrollView关联到窗口时，它会为我们调用fListView
    // 上的AddChild()。
    // 如果我们在创建滚动视图前，调用了fListView的AddChild()，当我们在
    // BScrollView中调用AddChild()时，我们的程序将进入调试器 -- 一个视
    // 图仅可以有一个父视图。
    BScrollView *scrollView = new BScrollView(&quot;scrollview&quot;, fListView,
                                                    B_FOLLOW_ALL, 0, true, true);
    top-&gt;AddChild(scrollView);

    // 任何时候列表选择状态发生改变，都会向窗口发送 BListView
    // 的选择消息。
    fListView-&gt;SetSelectionMessage(new BMessage(M_SET_TITLE));

    fListView-&gt;AddItem(new BStringItem(&quot;Toe Wrestling&quot;));
    fListView-&gt;AddItem(new BStringItem(&quot;Electric Toilet Racing&quot;));
    fListView-&gt;AddItem(new BStringItem(&quot;Bog Snorkeling&quot;));
    fListView-&gt;AddItem(new BStringItem(&quot;Chess Boxing&quot;));
    fListView-&gt;AddItem(new BStringItem(&quot;Cheese Rolling&quot;));
    fListView-&gt;AddItem(new BStringItem(&quot;Unicycle Polo&quot;));
}

void
MainWindow::MessageReceived(BMessage *msg)
{
    switch (msg-&gt;what)
    {
            case M_RESET_WINDOW:
            {
                    fListView-&gt;DeselectAll();
                    break;
            }
            case M_SET_TITLE:
            {
                    int32 selection = fListView-&gt;CurrentSelection();
                    if (selection &lt; 0)
                    {
                            // 这个代码之所以在这里是因为我们按下 Reset按钮时，
                            // 选取状态改变，并发送 M_SET_TITLE。但是由于并未
                            // 选中任何内容，CurrentSelection()返回 -1。
                            SetTitle(&quot;The Weird World of Sports&quot;);
                            break;
                    }

                    BStringItem *item = dynamic_cast&lt;BStringItem*&gt;(
                                                    fListView-&gt;ItemAt(selection));
                    if (item)
                            SetTitle(item-&gt;Text());

                    break;
            }

            default:
            {
                    BWindow::MessageReceived(msg);
                    break;
            }
    }
}
</pre></div>
</div>
<p>这个项目和上节中的项目并没有太多不同之处。通过调用 BListView 的 SetSelectionMessage() 方法，我们让标题能够在用于点击列表中的条目时及时进行更新。通常我们使用 BListView 时，并不会使用这个方法。相对使用更加频繁的是：</p>
<p>SetInvocationMessage()，用于在用于双击条目时发送消息。需要注意的是，DeselectAll() 也会引起选中消息的发送，即使并没有选择，因此有必要处理这种情况，当 CurrentSelection() 返回负值时，标明没有选择。
幸好您已经对 BView 和常用控件如何一起应用到程序中有所感觉。它们大多数都需要使用 BRect 标识其尺寸和位置，const char * 标识控件名称的，两个整型标识其尺寸修改模式和其他的行为标志。许多类也具有标签和当控件修改或调用时发送的消息，有其是那些继承自 BControl 的类。控件创建后，它将通过 AddChile() 函数关联到 BWindow 或 BView。控件发送的消息通常发送到其所关联到的窗口，但是它也可以定位到其他目标，例如其父类 BView 或者全局的 BApplication。</p>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id26">需要记住的内容</a><a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<div class="section" id="bcontrol">
<h3><a class="toc-backref" href="#id27">BControl</a><a class="headerlink" href="#bcontrol" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>ResizeToPreferred(void) - 子类调用它调整自己至合适尺寸以显示其标签和内容。</li>
<li>SetLabel(const char <a href="#id7"><span class="problematic" id="id8">*</span></a>label)/const char * Label(void) - 用于获取和设置子类的标签的方法。</li>
<li>SetTarget(BHandler <a href="#id9"><span class="problematic" id="id10">*</span></a>handler, BLooper <a href="#id11"><span class="problematic" id="id12">*</span></a>looper) - 发送调用小弟到不同的目标，如 BView，BWindow，或者 BApplication。</li>
<li>void SetEnabled(bool enabled)/bool IsEnabled(void) - 用于获取和设置控件启用/禁用状态的方法。</li>
</ul>
</div>
<div class="section" id="blistview">
<h3><a class="toc-backref" href="#id28">BListView</a><a class="headerlink" href="#blistview" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>AddItem(BListItem <a href="#id13"><span class="problematic" id="id14">*</span></a>item) - 添加条目到列表。</li>
<li>int32 CountItems(void) - 返回列表中条目的数量。</li>
<li>BListItem <a href="#id15"><span class="problematic" id="id16">*</span></a>RemoveItem(int32 index) - 移除并返回指定索引的条目，如果不存在，则返回 NULL。</li>
<li>void RemoveItem(BListItem <a href="#id17"><span class="problematic" id="id18">*</span></a>item) - 从列表中移除指定条目。如果列表中不存在，则不作任何动作。</li>
<li>int32 CurrentSelection(int32 index = -1) - 返回当前选中项目的索引，如果不存在，则为 -1。index 参数用于获取支持多条目选择的列表中所有的选中项目。通常会有一个 while() 循环来获取所有的条目标记，并且当返回 -1 是，它将会退出。</li>
<li>void Select(itn32 index, bool extend = false) - 从指定索引中选择条目。如果extend为false，在指定条目选定前，所有其他的条目将会取消选定。</li>
<li>void Select(int32 start, int32 end, bool extend = false) - 选中 start 到 end 之间的所有条目。如果 extend 为 false，在指定条目选定前，其他的所有条目取消选定。</li>
<li>void DeselectAll(void) - 取消选定列表中的所有条目。</li>
</ul>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; 版权所有 2015, Haiku Chinese Group.
      最后更新于 Aug 16, 2015.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>